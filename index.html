<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aheev â€” Open Source Portfolio</title>
  <link rel="stylesheet" href="assets/style.css">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="title-group">
        <h1>Ally Heev <span class="muted">/ @aheev</span></h1>
        <p class="subtitle">Open-source contributions â€” Apache Kafka Â· Apache Iceberg Â· Linux kernel</p>
      </div>
      <div class="controls">
        <button id="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      </div>
    </div>
  </header>

  <main class="wrapper">
    <nav class="tags">
      <button class="tag" data-filter="all">All</button>
      <button class="tag" data-filter="github">GitHub</button>
      <button class="tag" data-filter="jira">Kafka JIRA</button>
      <button class="tag" data-filter="kernel">Kernel</button>
      <button class="tag" data-filter="gitkernel">git.kernel.org</button>
    </nav>

    <section class="overview row">
      <div class="card stats">
        <h3>Totals</h3>
        <div id="totals">Loadingâ€¦</div>
      </div>

      <div class="card small">
        <h3>Quick counts</h3>
        <ul id="quick-counts">
          <li>GitHub PRs: â€”</li>
          <li>Kafka JIRA: â€”</li>
          <li>Kernel patches: â€”</li>
          <li>git.kernel.org commits: â€”</li>
        </ul>
      </div>
    </section>

    <section class="analytics">
      <h2>Analytics & Timelines</h2>

      <div class="grid">
        <div class="card">
          <h4>PRs / tickets / patches (monthly)</h4>
          <canvas id="timelineChart" height="160"></canvas>
        </div>

        <div class="card">
          <h4>Subsystem distribution (kernel)</h4>
          <canvas id="subsystemChart" height="160"></canvas>
        </div>

        <div class="card">
          <h4>Repos contributed & Stars (top)</h4>
          <canvas id="reposChart" height="160"></canvas>
        </div>
      </div>
    </section>

    <section class="latest">
      <h2>Latest contributions</h2>
      <div id="latest-list">Loadingâ€¦</div>
    </section>

    <footer class="footer">
      <p>Site updated automatically. Data & analytics generated from GitHub, Apache JIRA, lore.kernel.org and git.kernel.org.</p>
    </footer>
  </main>

<script>
/* Basic app loader: loads data json and populates page; charts handled in assets/charts.js */
async function loadJSON(path){
  try{ const r = await fetch(path, {cache: 'no-store'}); return r.ok ? r.json() : null }
  catch(e){ return null }
}

async function init(){
  const [gh, jira, linux, gitk, analytics] = await Promise.all([
    loadJSON('data/github.json'),
    loadJSON('data/kafka_jira.json'),
    loadJSON('data/linux_patches.json'),
    loadJSON('data/gitkernel.json'),
    loadJSON('data/analytics.json')
  ]);

  // Totals & quick counts
  const totalsEl = document.getElementById('totals');
  const quick = document.getElementById('quick-counts');

  const ghCount = gh?.items?.length || 0;
  const ghMerged = gh?.mergedCount || 0;
  const jiraCount = jira?.total || 0;
  const linuxCount = linux?.count || 0;
  const gitkCount = gitk?.count || 0;

  totalsEl.innerHTML = `
    <div class="big">${ghMerged}</div>
    <div class="muted">merged PRs on GitHub</div>
    <div style="margin-top:8px"><strong>${ghCount}</strong> total PRs Â· <strong>${jiraCount}</strong> Kafka tickets</div>
  `;
  quick.innerHTML = `
    <li>GitHub PRs: <strong>${ghCount}</strong></li>
    <li>GitHub merged: <strong>${ghMerged}</strong></li>
    <li>Kafka JIRA: <strong>${jiraCount}</strong></li>
    <li>Kernel patches (lore): <strong>${linuxCount}</strong></li>
    <li>git.kernel.org commits: <strong>${gitkCount}</strong></li>
  `;

  // Latest list
  const latest = [];
  if(gh?.items) latest.push(...gh.items.map(i=>({type:'GitHub PR', title:i.title, link:i.url, date:i.mergedAt || i.updatedAt})));
  if(jira?.items) latest.push(...jira.items.map(i=>({type:'Kafka JIRA', title: i.key + ': ' + i.fields.summary, link: 'https://issues.apache.org/jira/browse/' + i.key, date: i.fields.updated})));
  if(linux?.items) latest.push(...linux.items.map(i=>({type:'Kernel patch', title: i.title || i.subject, link: i.link || i.url, date: i.date})));
  if(gitk?.items) latest.push(...gitk.items.map(i=>({type:'git.kernel', title:i.title, link:i.url, date:i.date})));

  latest.sort((a,b)=> new Date(b.date) - new Date(a.date));
  const latestEl = document.getElementById('latest-list');
  latestEl.innerHTML = '<ul class="list">' + latest.slice(0,20).map(x=>`<li class="list-item"><span class="pill">${x.type}</span> <a href="${x.link}" target="_blank">${x.title}</a> <span class="muted">(${new Date(x.date).toLocaleDateString()})</span></li>`).join('') + '</ul>';

  // Charts
  if(typeof initCharts === 'function' && analytics) {
    initCharts(analytics);
  }
}
init();

/* Theme toggle */
const themeToggle = document.getElementById('theme-toggle');
const root = document.documentElement;
const stored = localStorage.getItem('theme');
if(stored) root.setAttribute('data-theme', stored);
themeToggle.addEventListener('click', ()=>{
  const cur = root.getAttribute('data-theme') || 'dark';
  const next = cur === 'dark' ? 'light' : 'dark';
  root.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
  themeToggle.textContent = next === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
});

/* Tag filtering (simple client-side) */
document.querySelectorAll('.tag').forEach(b=>{
  b.addEventListener('click', ()=> {
    const filter = b.getAttribute('data-filter');
    document.querySelectorAll('.pill').forEach(p=>{
      p.parentElement.style.display = (filter === 'all' || p.textContent.toLowerCase().includes(filter)) ? '' : 'none';
    });
  });
});
</script>

<script src="assets/charts.js"></script>
</body>
</html>
